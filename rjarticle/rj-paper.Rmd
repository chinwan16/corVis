---
title: "corVis: An R Package for Visualising Associations and Conditional Associations"
abstract: >
  We present \CRANpkg{corVis}, an R package for visualizing association and conditional association using measures of association. The package provides matrix and linear layout for displaying bivariate association (and grouped by levels of a categorical variable) , using measures suitable for numerical, ordinal and nominal variables. With these displays, an analyst can gain a quick overview about the interesting structure and underlying patterns in the data. We provide a detailed look at the package functions and discuss the implemented design choices. We also provide an illustration of the package on an example dataset.
draft: true
author:  
  
  - name: Amit Chinwan
    affiliation: Maynooth University
    address:
    - Hamilton Institute
    - Maynooth, Ireland
    email:  amit.chinwan.2019@mumail.ie
  - name: Catherine Hurley
    email: catherine.hurley@mu.ie
    affiliation: Maynooth University
    address:
    - Department of Mathematics and Statistics
    - Maynooth, Ireland
type: package
output: 
  rjtools::rjournal_web_article:
    self_contained: yes
    toc: no
bibliography: RJreferences.bib
editor_options: 
  chunk_output_type: console
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(corVis)
library(palmerpenguins)
library(ggplot2)
library(dplyr)
library(kableExtra)
library(magrittr)
```

# Introduction

The first stage in data analysis includes exploring numerical and graphical variable summaries using different statistical tools. One such tool to explore bivariate patterns is a correlation matrix display which is applied to numerical variables only. These displays are typically used with Pearson's correlation coefficient, a measure of linear dependency, and will mislead an analyst about relationships that aren't linear. In addition, correlation displays commonly use a matrix layout which becomes inefficient when used with high-dimensional datasets.

In this paper, we introduce the R package \CRANpkg{corVis} which addresses the challenges of existing correlation matrix display. Our goal in this package is to investigate and visualise associations using measures of association. In \CRANpkg{corVis}, we focus on:

1. Association measures for different variable types to go beyond numeric variables
2. Multiple association measures to explore linear and non-linear associations.
3. Conditional association measures to explore patterns at different levels of a conditioning variable
4. Displays for the above three situations in the matrix and linear layouts 

As many datasets are a mix of variable types, we use association measures suitable for both numerical and categorical variables. This helps in exploring association for all the pairs of variables in a single plot. We focus on four types of variable pairs which are numeric, factor, ordinal and mixed. We consider a variable pair to be mixed when one of the variables is numeric and the other is categorical. 

While exploring association among variables, it is possible to have pairs of variables which are highly associated and not picked by Pearson's correlation, which is a measure of linear association. Because of this, we go beyond Pearson, Spearman and Kendall correlation, and look at alternative measures such as distance correlation [@szekely2007measuring], maximal information coefficient (MIC) [@reshef2011detecting]], ace [@wang2005identifying] from alternating conditional expectations algorithm and more, which are capable of capturing non-linear patterns. We compare these multiple measures for each pair of variables so that patterns other than linear can be uncovered.

There may exist variable pairs which show different patterns at different levels of a categorical variable. In order to report these variable pairs to an analyst, we calculate association measures at different levels of a categorical variable for every variable pair in the dataset. On comparison of these measures, we can discover variable pairs showing different structures at different levels of the conditioning or grouping variable.

The above measures are displayed using different layouts. Our first display uses a matrix-layout, similar to existing correlation matrix displays. A novel feature is that our version can show multiple association measures for each pair of variables so that patterns other than linear association can be uncovered. For high-dimensional datasets, matrix layouts become unwieldy and run out of space, so our second display uses a linear layout, showing one or more association measures for each pair of variables. This is especially useful when the analyst wishes to limit the display to pairs of variables showing non-negligible associations.

We also use seriation methods for both matrix and linear displays such that highly-associated variables or variable pairs with high differences among the measures are placed nearby and are easier to identify. It has been shown that ordering provides a better perception of visualisations and makes it easier to identify patterns in the data. @jacques1983semiology showed that the understanding of a matrix is simplified by reordering rows and columns of the matrix. @friendly2002corrgrams demonstrated ordered correlation displays so that groups of variables with high mutual correlation are quickly identified and @hurley2004clustering ordered variables in a scatterplot matrix so that interesting panels were positioned close to the main diagonal. 

In addition to calculating and displaying association measures, we also provide a new tibble data structure for the output of association measures for different variable types, multiple measures of association and conditional association measures. These data structures can be easily explored further using data manipulation and visualization tools of \CRANpkg{tidyverse} [@tidyverse].


<!-- The first stage in data analysis includes exploring numerical and graphical variable summaries using different statistical tools. One such tool to explore bivariate patterns is a correlation matrix of numerical variables. Many datasets include a mix of variable types. A general approach to using a correlation matrix with mixed variables is to convert a categorical variable into a binary variable if it has only two levels or create $k$ binary variables representing $k$ levels of the categorical variable. An issue with this approach is that for variables having more than two levels, it is not easy to assess the overall correlation. The new package \CRANpkg{corVis} fills this gap and extends the correlation matrix for different variable types. Our goal in this package is to investigate and visualise associations using measures of association, in datasets with mixed variable types. -->
<!-- In this work, we produce visualizations displaying summary measures of bivariate patterns. We use association measures suitable for both numerical and categorical variables. We focus on four types of variable pairs which are numeric, factor, ordinal and mixed. There are no measures available for numeric and ordinal variable pairs in the literature. One could use Kendall or Spearman rank correlation by numerically coding the levels of the ordinal variable. We refrain from using this strategy and treat these pairs as mixed in the package. For numeric pairs, we go beyond Pearson, Spearman and Kendall correlation, and use methods such as distance correlation [@szekely2007measuring], maximal information coefficient (MIC) [@reshef2011detecting]], ace [@wang2005identifying] from alternating conditional expectations algorithm and more, which are capable of capturing non-linear patterns.  -->
<!-- Our first display uses a matrix-layout, similar to existing correlation matrix displays. A novel feature is that our version can show multiple association measures for each pair of variables so that patterns other than linear association can be uncovered. For high-dimensional datasets, matrix layouts become unwieldy and run out of space, so our second display uses a linear layout, showing one or more association measures for each pair of variables. This is especially useful when the analyst wishes to limit the display to pairs of variables showing non-negligible associations. -->
<!-- We also present displays of bivariate association grouped by levels of a categorical variable, again using matrix and linear layouts. These displays are useful for discovering variable pairs showing different patterns at different levels of the grouping or conditioning variable. We also use seriation methods for both matrix and linear displays such that highly-associated variables or variable pairs with high differences among the measures are placed nearby and are easier to identify. It has been shown that ordering provides a better perception of visualisations and makes it easier to identify patterns in the data. @jacques1983semiology showed that the understanding of a matrix is simplified by reordering rows and columns of the matrix. @friendly2002corrgrams demonstrated ordered correlation displays so that groups of variables with high mutual correlation are quickly identified and @hurley2004clustering ordered variables in a scatterplot matrix so that interesting panels were positioned close to the main diagonal.  -->

In this paper, we introduce the R package \CRANpkg{corVis} where we calculate the measures of association for pairs of variables in a tidy data structure and use this structure to produce displays. The next section provides a review of existing packages which deal with correlation displays and a background on association measures and the packages used for calculating them. Then we describe our approach to calculating the association measures, followed by illustrations of the proposed displays. We conclude with a discussion and future work.

# Background

In this section, we provide a brief review of existing packages used for correlation displays, seriation techniques and association measures used in the package \CRANpkg{corVis}. 


## Correlation Displays

According to @hills1969looking, "the first and sometimes only impression gained by looking at a large correlation matrix is its largeness". To overcome this, @murdoch1996graphical proposed a  display for large correlation matrices which uses a matrix layout of ellipses where the parameters of the ellipses are scaled to the correlation values. @friendly2002corrgrams  expanded on this idea by rendering correlation values as shaded squares, bars, ellipses, or circular ‘pac-man’ symbols.

```{r corrdisplay-packages,warning=FALSE,message=FALSE,echo=FALSE }
library(kableExtra)

Package <- c("corrplot","corrr","corrgrapher","linkspotter",  "correlation","corVis")

Display <- c("heatmap","heatmap/network","network","network","heatmap/network","heatmap/matrix/linear")


MixedVariables <- c(" "," "," ","Yes"," ","Yes")



df <- data.frame(Package=Package,
                 Display=Display,
                 MixedVariables=MixedVariables)

kableExtra::kbl(df, booktabs = T, caption = "List of the R packages dealing with correlation or correlation displays with information on whether the plots display multiple measures, conditional display of measures and mixed variables in a single plot")
#print(table_1)
#df %>%
  #kbl() %>%
  #kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

Nowadays, there are many R  packages devoted to correlation visualisation. Table \@ref(tab:corrdisplay-packages) provides a summary, listing the displays offered, and whether these extend to factor variables or mixed numeric-factor pairs.  

The R package \CRANpkg{corrplot} [@corrplot2021] provides an implementation of the methods in @friendly2002corrgrams and produces displays in a matrix layout. The package \CRANpkg{corrr} [@corrr2020] organises correlations as tidy data first, so leveraging the data manipulation and visualisation tools of the \CRANpkg{tidyverse} [@tidyverse], which then can be displayed in a matrix format. @grimm2017kennzahlenbasierte in the package \CRANpkg{mbgraphic} explored correlation structure of numeric variables using an interactive shiny application in matrix arrangement. She extended the display to general measures like scagnostics, which are measures characterizing a scatterplot based on trend or density, along with two more measures, based on smoothing splines and distance correlation and compared these measures for variable selection.

The package \CRANpkg{corrgrapher} [@corrgrapher] uses a network plot for exploring correlations, where the nodes close to each other have high correlation magnitude, edge thickness encodes the absolute correlation value and edge color indicates the sign of correlation. The package also handles mixed type variables by using association measures obtained as transformations of $p$-values obtained from Pearson's correlation test in the case of two numeric variables, Kruskal's test for numerical and factor variables, and a chi-squared test for two categorical variables. The package \CRANpkg{corrr} [@corrr2020] also offers network displays where line-thickness encodes correlation magnitude, with a filtering option to discard low-correlation edges. Another package for plotting correlations in a network layout is \CRANpkg{linkspotter} [@linkspotter] which offers a variety of association measures (distance correlation, MIC, maximum normalized mutual information) in addition to correlation, where the measure used depends on whether the variables are both numerical, categorical or mixed. The results are visualized in a network plot, which may be packaged into an interactive shiny application.

The R package \CRANpkg{correlationfunnel} offers a novel linear display which assists in feature selection in a setting with a single response and many predictor variables. All numeric variables including the response are binned. All (now categorical) variables in the resulting dataset are one-hot encoded and Pearson's correlation calculated with the response categories. The correlations are visualised in a dot-plot display, where predictors are ordered by maximum correlation magnitude. Correlations between one-hot encoded variables are challenging to interpret, especially as the number of levels increase.  In corVis we offer a similar dot-plot display, but showing multiple correlation or association measures, or alternatively measures stratified by a grouping variable.

Our own package \CRANpkg{corVis} offers a variety of displays, and has new features not available elsewhere, in particular simultaneous display of multiple association measures, and association displays stratified by levels of a grouping variable. This will be described  in the following sections.

<!-- @friendly2002corrgrams also focused on ordering of the variables for correlation displays where the variables were ordered using the angular ordering of the first two eigen vectors of the correlation matrix. The ordering places highly-correlated pairs of variables nearby, making it easier to quickly identify groups of variables with high mutual correlation. The package \CRANpkg{corrplot} [@corrplot2021] provides various ordering techniques for matrix displays along with the method implemented in @friendly2002corrgrams. -->


<!-- There have been other extensions to correlation displays which are useful when dealing with high dimensional datasets.  -->
<!-- @hills1969looking proposed a QQ plot of the $z$-transform of the entries of the correlation matrix to discover correlation coefficients too large to come from a normal distribution with mean zero. @buja2016visualization proposed Association Navigator which is an interactive visualization tool for large correlation matrices with upto 2000 variables.  The R package \CRANpkg{scorrplot} [@scorr] produces an interactive scatterplot for exploring pairwise correlations in a large dataset by projecting variables as points on a scatterplot with respect to some user-selected variables of interest, driven by a geometric interpretation of correlation and encoding the correlation as vertical gridlines in the plot. The package allows user to update variable of interest which creates tour of the correlation space between different projections of the data.  -->

## Association Measures

An association measure is defined as a numerical summary quantifying the relationship between two or more variables. The measure is called symmetric if its value is invariant to the choice of independent or dependent variable during the calculation. For example, Pearson's correlation coefficient summarizes the strength and direction in the range $[-1,1]$ of the linear relationship present between two numeric variables and is symmetric. Kendall's or Spearman's rank correlation coefficient are other popular measures which assess monotonic relationships in interval $[-1,1]$ among two numeric variables and are symmetric measures. 

Pearson's correlation coefficient is generally used with correlation displays to understand bivariate relationships. But its limitations such as the influence of outliers on its magnitude and measuring only linear dependencies make it a less useful measure. The recently developed measures such as distance correlation [@szekely2007measuring] and MIC [@reshef2011detecting] overcome these limitations and are more suitable for datasets with both linear and non-linear patterns.

<!-- Figure \@ref(fig:motivation-patterns) shows a plot of simulated linear and non-linear patterns. The first row shows a linear relationship along with the value for measures such as Pearson's correlation, distance correlation and maximal information coefficient respectively for the pattern. In a similar manner, the second row shows a quadratic relationship and its values for  Pearson's correlation, distance correlation and maximal information coefficient respectively.    -->
<!-- It is clearly evident from Figure \@ref(fig:motivation-patterns) that all the three measures summarizes the pattern with linear relationship quite well. For the non-linear pattern, distance correlation and MIC are better in detecting underlying relationship than Pearson's correlation. This suggests that association measures such as distance correlation, MIC and other measures should be used along with Pearson's correlation for exploring relationships among variables in the datasets where there is no prior knowledge about the possible patterns in the data. -->

The distance correlation coefficient [@szekely2007measuring] is an association measure which looks for any relationship between two numeric variables using the distances between observations of these variables and summarizes the relationship in $[0,1]$. The distance correlation is $0$ when the variables are independent and $1$ when the variables are perfectly linear, and is a symmetric measure. 

The maximal information coefficient (MIC) [@reshef2011detecting] is an information theory measure which uses mutual information among the two variables for its calculation. The main idea is to find a grid out of possible grids on a scatterplot of two numeric variables, in order to discretize the variables, which maximises the mutual information. A normalisation technique is used to make the mutual information from different grids comparable. Referred to as 'a correlation of 21st century' [@speed2011correlation], MIC is capable of summarizing different types of relationships, not just linear or monotonic, between numeric variables and is in the interval $[0,1]$. MIC is a symmetric measure where a zero value indicates independence among the variables and a value of 1 represents a  noiseless functional relationship. @reshef2011detecting used MIC and other related statistics to explore pairwise relationships in large data sets such as major-league baseball, gene expression, global health, and the human gut microbiota. 

Both distance correlation and MIC have advantages of detecting non-linear and complex relationship but these measures aren't perfect yet. @commentSimonTibshirani showed that distance correlation has more statistical power than MIC. Also, distance correlation is not an approximation when compared to MIC. On the other hand, distance correlation computation is slower as compared to the conventional association measures such as Pearson's correlation for datasets with high number of cases.

Correlation displays commonly use numeric variables while exploring bivariate associations in a dataset and often ignore categorical variables. There are measures available in the literature for exploring associations involving categorical variables. For nominal variable pairs, measures such as Pearson's contingency coefficient and Uncertainty coefficient [@theil1970estimation] are used to quantify the association. Pearson's contingency coefficient is a symmetric measure which uses the ${\chi}^2$ value from Pearson's ${\chi}^2$ test for independence and is scaled in the interval $[0,1]$. The uncertainty coefficient [@theil1970estimation] measures the proportion of uncertainty in one variable which is explained by the other. The uncertainty coefficient is in the range $[0,1]$ and is not symmetric. A symmetric version is used by taking the mean of the uncertainty coefficients obtained by treating each variable as an independent variable once. 

@agresti2010analysis provides an overview of the measures which are used for exploring the association between ordinal variables. Kendall's tau-b [@kendall1945treatment] is a measure of the strength and direction of the association between two ordinal variables. It is based on the number of concordances and discordances in paired observations of the variables and summarizes the association in the range $[-1,1]$. The polychoric correlation [@olsson1979maximum] measures the correlation between two ordinal variables by assuming two normally distributed latent variables and summarizes the association in $[-1,1]$. Both of these measures are symmetric.

In \CRANpkg{corVis}, we provide multiple association measures which can discover non-linear patterns and interesting associations featuring categorical variables.


## Seriation

Careful ordering of graphical displays makes it easier to identify patterns and structures. For example, in a barplot of Covid death rate by country, sorting by death rate (instead of alphabetical order) helps identify groups of countries with high (or low) death rates. Other complex ordering examples include @friendly2002corrgrams who demonstrated ordered correlation displays where the variables were ordered using the angular ordering of the first two eigen vectors of the correlation matrix. The ordering places highly correlated pairs of variables nearby, making it easier to quickly identify groups of variables with high mutual correlation. The package \CRANpkg{corrplot} [@corrplot2021] provides various ordering techniques for correlation displays along with the method implemented in @friendly2002corrgrams. 

The above examples illustrate how seriation, a term to describe the ordering of objects, is useful to reveal interesting patterns. In \CRANpkg{corVis}, we use seriation methods from \CRANpkg{DendSer} [@DendSer] package to seriate matrix displays and use importance sorting for ordering the linear displays.

# Introducing corVis

Many of the existing correlation displays are limited to numeric pairs of variables. The package \CRANpkg{corVis} extends these displays to mixed variable types. The main goal of our work is to propose displays for multiple association measures and conditional associations which are useful for uncovering interesting patterns in the data. This will help in identifying variable pairs which shows a type of relationship or pattern in a dataset with large number of variables.

```{r motivation2, fig.width=5, fig.height=4, fig.align='center', fig.cap = "An example plot showing importance of conditional displays"}
# 
# a <- data.frame( x = rnorm(100), y = rnorm(100)) %>% mutate(y = y-x/2)
# b <- a %>% mutate(x=x+2) %>% mutate(y=y+2)
# c <- a %>% mutate(x=x+4) %>% mutate(y=y+4)
# data <- do.call(rbind, list(a,b,c))
# data <- data %>% mutate(group=rep(c("A", "B", "C"), each=100))
# 
# p1 <- ggplot(data=data) + geom_point(aes(x=x,y=y))
# p2 <- ggplot(data=data) + geom_point(aes(x=x,y=y, color=group))
# 
# gridExtra::grid.arrange(p1,p2,ncol=2)
```

<!-- Consider Figure \@ref(fig:motivation2) for the motivation behind conditional association displays. The plot on the left shows a positive linear association between `y` and `x` and has a positive Pearson's correlation of value 0.603. The plot on the right shows the disaggregated data by the `group` variable and it is clearly evident that for each group there is a negative linear relationship between `y` and `x`. This is an example of Simpson's paradox and is one of the patterns which are discoverable when conditional association displays are used. -->

While designing these displays we consider matrix and linear layouts. A matrix layout reduces the effort in looking up for a variable pair corresponding to a cell or panel, and different measures may be displayed on the upper and lower triangle of the matrix. On the other hand, the filtering of variable pairs, for example pairs having measure value greater than a threshold, is easier with linear layouts in comparison to matrix layouts.

Table \@ref(tab:function-corVis) provides a list of the functions available in the package. The functions `calc_assoc` and `calc_assoc_all` are responsible for calculating association measures which are used as input for the `plot_assoc_matrix` and `plot_assoc_linear` functions. The functions `plot_assoc_matrix` and `plot_assoc_linear ` produces association display, multiple association measures display and conditional association display, in a matrix and linear layout respectively. We provide detailed examples on calculation and visualisation of association and conditional association in next sections.

<!-- which are useful for calculating association measures among variable pairs and visualising these associations using novel displays. Section 4 provides a detailed description on functions used for calcuating association measures in the package. Section 5 illustrates the use of visualising functions in table \@ref(tab:function-corVis) for displaying pairwise association and conditional association. -->


```{r function-corVis,warning=FALSE,message=FALSE,echo=FALSE }
library(kableExtra)

Function <- c("calc_assoc","calc_assoc_all","plot_assoc_matrix","plot_assoc_linear",
              "show_assoc")

Usage <- c("Calculation","Calculation","Visualization","Visualization",
           "Visualization")

#Usage <- c(rep("Calculation",5),rep("Visualization",3),rep("Visualization",5),rep("Visualization",4),rep("Visualization",5))

Description <- c("Calculates association measures",
                 
                 "Calculates all the association measures available in package",
                 
                 "Visualize assocition and conditional association in matrix plot",
                 
                 "Visualize assocition and conditional association in linear plot",
                 
                 "Association (or conditional) plot for a pair of variables")


df <- data.frame(Function=Function,
                 Usage=Usage,
                 Description=Description)

kableExtra::kbl(df,booktabs = T, caption = "List of functions in corVis package") %>%
  kableExtra::column_spec(1, bold=T)


  #kableExtra::collapse_rows(columns = 1:2)

#print(table_1)
#df %>%
  #kbl() %>%
  #kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

# Example: Data

We use the Daily Bike Sharing dataset [@bikeref] from the R package \CRANpkg{timetk} [@timetk] which contains daily count of rental bike transactions between years 2011 and 2012 in Capital bikeshare system. The dataset also includes corresponding daily weather information such as humidity, temperature and windspeed, and seasonal information such as season, whether the day is a holiday and whether the day is a working day.

```{r bikedata,warning=FALSE,message=FALSE,echo=FALSE }
library(kableExtra)
library(timetk)
bike <- bike_sharing_daily[,-1] |>
  mutate(season= recode_factor(season,
                               `1`="Winter", `2`="Spring", `3`="Summer", `4`="Fall"),
         weathersit= recode_factor(weathersit, 
                         `1`="clear", `2`="cloudy", `3`="lightP", `4`="heavyP"),
         holiday=recode_factor(holiday, `0` = "No", `1`="Yes"),
         workingday = recode_factor(workingday, `0` = "No", `1`="Yes"),
         yr = recode_factor(yr,`0` = 2011, `1`=2012),
         weekday = recode_factor(weekday,`0` = "sun", `1` = "mon", `2`="tue", `3` = "wed", `4`="thu", `5`="fri", `6`="sat"),
         mnth = factor(month.abb[mnth], levels=month.abb)
         )
levels(bike$weathersit)<- rev(levels(bike$weathersit))

variable <- names(bike)

description <- c("date",
                 "season with categories Winter, Spring, Summer and Fall",
                 "year of day with categories 2011 and 2012",
                 "month of day with months as categories",
                 "whether day is a holiday or not",
                 "day of the week",
                 "if day is neither weekend nor holiday it is Yes, otherwise is No",
                 "weather situation of the day with categories clear, cloudy, lightP",
                 "normalized temperature in Celsius",
                 "normalized feeling temperature in Celsius",
                 "normalized humidity",
                 "normalized windspeed",
                 "count of casual users",
                 "count of registered users",
                 "count of total rental bikes including both casual and registered")

variable_type <- c("date","nominal","nominal","nominal","nominal","nominal","nominal","nominal","numeric","numeric","numeric","numeric","numeric","numeric","numeric")

df <- data.frame(Variable=variable,
                 Description=description,
                 VariableType=variable_type
                 )

kableExtra::kbl(df, booktabs = T, caption = "Variable description of the Daily Bike Sharing dataset") |>
  kableExtra::kable_styling(latex_options = "scale_down")
#print(table_1)
#df %>%
  #kbl() %>%
  #kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

Table \@ref(tab:bikedata) provides a brief description of Daily Bike Sharing data along with the types of variables present in the dataset. We use the dataset throughout this paper for illustrative usage of the package.

# corVis: Data Structures

We provide three tidy data structures which are explored using functions in \CRANpkg{corVis} or can be manipulated or visualized by leveraging tools in \CRANpkg{tidyverse} These data structures are: `pairwise`, `multi_pairwise` and `cond_pairwise`. In this section, we provide an example of these three data structures along with how they are beneficial when used in the \CRANpkg{tidyverse} environment.

The `pairwise` data structure is a data format which contains scores for pairs of variables in a dataset for which a specified measure is defined. For example, the function `tbl_dcor` calculates the distance correlation measure for every numeric variable pair in the dataset. Each row of the `pairwise` object is characterized by the variable pair and association measure type.

```{r, pairwise-example,echo=TRUE}
# a subset of bike dataset
bike_s <- bike |> 
  dplyr::select(temp, windspeed, registered,weathersit, workingday)
dcor_bike <- tbl_dcor(bike_s)
dcor_bike
class(dcor_bike)
```


We define a `multi_pairwise` data structure as a data format which consists of multiple scores for variable pairs in the dataset. Similar to the `pairwise` object, every row of the `multi_pairwise` object is defined by the variable pair and measure type. An analyst interested in finding how different the association measure values are for each pair can use this object with \CRANpkg{tidyverse} tools to find the range of measures.

```{r,multipairwise-example,echo=TRUE}
multi_bike <- calc_assoc_all(bike_s,
                                 c("pearson","nmi","ace","uncertainty"))
class(multi_bike)

# calculating range of measures
multi_bike |> 
  group_by(x,y) |>
  summarise(range=max(measure)-min(measure),.groups = "drop") |>
  arrange(desc(range))
```


The final data structure in \CRANpkg{corVis} is `cond_pairwise` which contains scores for every variable pair at different levels of a conditioning variable. In this case, each row is uniquely identified by a variable pair and a level of the conditioning variable. For exploring pairwise differences in groups, an analyst can easily use data manipulation tools available in \CRANpkg{tidyverse} ecosystem.

```{r,condpairwise-example,echo=TRUE}
cond_bike <- calc_assoc(bike_s,
                            by="weathersit")
class(cond_bike)

# calculating difference in the group
cond_bike |> 
  group_by(x,y) |>
  summarise(diff=max(measure)-min(measure),.groups = "drop") |>
  arrange(desc(diff))

```

It is worth noting that both `multi_pairwise` and `cond_pairwise` objects inherit the `pairwise` class and satisfies the definition of the `pairwise` data structure.  

# corVis: Calculating Association

This section describes the calculation of association measures in  package \CRANpkg{corVis}. The package  provides a standard interface for calculating a collection of measures which quantifies the relationship between two variables. The measures available in the package are not limited to numeric variables and are used with nominal, ordinal and mixed variable pairs as well. The package also provides a functionality for handling missing value or `NA` while calculating these association measures. 

Table \@ref(tab:association-measures) lists different functions provided in the package to calculate  measures along with the information on type of variable pairs they can be used with. It also include details about the external package functions used to calculate and the range for these measures. The association measures available in \CRANpkg{corVis} are symmetric. We convert asymmetric measures to symmetric by  taking either the mean or the maximum of the measures calculated by treating each variable from the pair as independent variable. The functions in Table \@ref(tab:association-measures) such as `tbl_ace` and `tbl_cancor` which calculates maximal correlation coefficient among the transformed variables and canonical correlation respectively, have been implemented in \CRANpkg{corVis}.

```{r association-measures,echo=FALSE}
measures <- dplyr::tribble(
  ~name, ~nn, ~ff, ~oo, ~nf, ~from, ~range,
  "tbl_cor", "y", " ", " " ," ", "stats::cor", "[-1,1]",
  "tbl_dcor", "y", " ", " ", " ", "energy::dcor2d", "[0,1]",
  "tbl_mine", "y", " ", " ", " ", "minerva::mine", "[0,1]",
  "tbl_ace", "y", "y", " ", "y", "corVis", "[0,1]",
  "tbl_cancor", "y", "y", " ","y", "corVis", "[0,1]",
  "tbl_nmi",  "y", "y", " ", "y", "linkspotter::maxNMI", "[0,1]",
  "tbl_polycor", " ", " ","y", " ", "polycor::polychor", "[-1,1]",
  "tbl_tau", " ", " ","y", " ", "DescTools::KendalTauA,B,C,W", "[-1,1]",
  "tbl_gkGamma", " ", " ", "y", " ", "DescTools::GoodmanKruskalGamma", "[-1,1]",
  "tbl_gkTau", " ", " ", "y", " ", "DescTools::GoodmanKruskalTau", "[0,1]",
  "tbl_uncertainty", " ",  "y", " ", " ", "DescTools::UncertCoef", "[0,1]",
  "tbl_chi", " ",  "y", " ", " ", "DescTools::ContCoef", "[0,1]"
)

kableExtra::kbl(measures,booktabs = T,caption = "List of the functions available in the package for calculating different association measures along with the packages used for calculation.") %>% kableExtra::kable_styling(latex_options = "scale_down")
```

For numeric pairs, the package provides popular correlation coefficients like Pearson, Spearman or Kendall and are calculated using `tbl_cor` function. The measures such as distance correlation or MIC for detecting non-linear patterns are implemented using `tbl_dcor` or `tbl_mine` respectively. For ordinal pairs, the measures such as polychoric correlation and Kendall's coefficients are used to find association and are computed by `tbl_polycor` or `tbl_tau` respectively. For nominal pairs , the functions `tbl_uncertainty`, `tbl_chi` or `tbl_cancor` are used for exploring association among the variables. 

We do not handle date times, or circular variables (usually time related). The only association measure which handles circular variables is ace, but we are not so far using this feature. In the bike data the circular variables are `season`, `month` and `weekday`.

The function `tbl_cancor` calculates a measure of association based on canonical correlations for mixed pairs of variables. Nominal variables are converted into sets of dummy variables, which are then assigned score to find the maximal correlation. For two numeric variables this measure is identical to absolute correlation, for two factors the correlation is identical to that obtained from correspondence analysis.

The functions listed in Table \@ref(tab:association-measures) for calculating association measures provide a functionality for handling missing value or `NA` in the dataset. Each of these functions either have a `handle.na` argument or automatically uses pairwise complete observations (depending on the package used for calculation) for taking care of missing values present in the data. 

The `tbl_*` functions outputs a data structure with class `pairwise`. We define a `pairwise` data structure as a data format which contain scores for pairs of variables in a dataset for which a specified measure is defined. In addition to `pairwise`, the package also has `multi_pairwise` and `cond_pairwise` data structures which are discussed in the later sections. These structures are useful for producing displays in \CRANpkg{corVis}.

## Calculating association measures for whole dataset

The `calc_assoc` function calculates association measures for every variable pair in a dataset. The variable pairs in the output are unique pairs in the dataset where `x` $\neq$ `y`. Because of the tidy structure of the output, the data manipulation and visualization tools of \CRANpkg{tidyverse} [@tidyverse] are applicable and are useful for further exploration of pairwise associations. The output of `calc_assoc` has a `pairwise` data structure which has one score (measure) for each pair of variable in the dataset.

The code snippet below shows the calculation of association measures for a subset of the bike sharing data. We select three numeric (temp, windspeed, registered) and two nominal variables (weathersit, workingday) from the original dataset to demostrate the usage of `calc_assoc`. We include all of the function arguments for the below example and describe how these are useful. The inputs such as `by` and `include.overall` will be described in the section [Calculating conditional association]. 

```{r, calc_assoc1,echo=TRUE}
bike_s <- bike |> 
  dplyr::select(temp, windspeed, registered,weathersit, workingday)
bike_s_assoc <- calc_assoc(d = bike_s,
                           by = NULL,
                           types = default_assoc(),
                           include.overall = NULL,
                           handle.na = TRUE,
                           coerce_types = NULL)
bike_s_assoc
```


The `types` argument is a tibble of the `tbl_*` functions for different types of variable pairs. The default is `default_assoc()` which includes `tbl_cor` if both the variables are numeric and calculates Pearson's correlation , `tbl_gkGamma` if both the variables are ordinal and computes Goodman and Kruskal's gamma and `tbl_cancor` for a factor pair and mixed pair and calculates canonical correlation.

```{r, default_assoc,echo=TRUE}
default_measures <- default_assoc()
default_measures
```


The default tibble of measures is updated using the `update_assoc` function. The argument `default` has `default_assoc()` tibble as its default value and is useful when `tbl_*` functions need to be updated for a few types of variable pairs. 

```{r, update_assoc,echo=TRUE}
updated_assoc <- update_assoc(default_measures,
                              num_pair = "tbl_cor",
                              num_pair_argList = "spearman",
                              mixed_pair = "tbl_cancor",
                              factor_pair = "tbl_nmi")
updated_assoc
updated_bike_s_assoc <- calc_assoc(d = bike_s, 
                                 types = updated_assoc)
updated_bike_s_assoc

```


The input `handle.na` for `calc_assoc` manages the `NA` or missing value in the data. The default value is set to `TRUE` for using pairwise complete observations for calculating a measure of association between two variables.

Sometimes an analyst might want to treat a factor as ordered. This will also be useful for pairs of binary variables where it will then be possible to see the direction of association. Alternatively, binary variables are treated as numerical. The input `coerce_types` is used to convert variable types. The code segment below demonstrates how nominal factors can be converted into ordinal.

```{r, coerce_types, echo=TRUE}
bike_s_assoc <- calc_assoc(d = bike_s,
                           by = NULL,
                           types = default_assoc(),
                           include.overall = NULL,
                           handle.na = TRUE,
                           coerce_types = list(ordinal=c("workingday", "weathersit")))
bike_s_assoc
```




## Calculating conditional association

The function `calc_assoc` is also used to calculate association measures for all the variable pairs at different levels of a categorical variable. This helps in exploring the conditional associations and finding out variable pairs showing different associations at different levels of the conditioning variable. The function has a `by` argument which is used as the grouping variable and needs to be categorical. The tibble output in the conditional setting has a similar structure as `calc_assoc` with an additional `by` column representing the levels of the categorical variable. The output data structure has a `cond_pairwise` class attribute which is used for displaying conditional measures. The data structure is also suitable for tidy operations with tools available in \CRANpkg{tidyverse} [@tidyverse].

The `x` and `y` variables in the output are repeated for every level of `by` variable. In order to have multiple `by` variables, the function `calc_assoc` is used multiple times with a different `by` variable each time and then the multiple outputs are binded row wise. 

```{r, by,echo=TRUE}
bike_s_assoc_by <- calc_assoc(d = bike_s,
                            by = "workingday",
                            include.overall = TRUE)
bike_s_assoc_by
```

By default, the function `calc_assoc` calculates the association measures for all the variable pairs at different levels of the grouping variable and the pairwise association measures for the ungrouped data (`overall`) when used with the `by` argument. This behavior can be changed by setting the `include.overall` argument to `FALSE`.

```{r, include.overall,echo=TRUE}
bike_s_assoc_by <- calc_assoc(d = bike_s,
                            by = "workingday",
                            include.overall = FALSE)
bike_s_assoc_by
```


## Calculating multiple association measures

The comparison of multiple association measures help discover patterns other than linear. We calculate multiple measures with `calc_assoc_all` function in the package. The function takes a dataset and a list of measures as input and outputs a tibble structure with multiple measures of association for every variable pair. The data structure has `multi_pairwise` class attribute which is used for plotting multiple measure displays in matrix and linear layouts. The code section below calculates `pearson`, `dcor` and `cancor` measures for the variable pairs in subset of bike sharing data. The pairs for which a measure is not defined is not included in the result.

```{r}
bike_s_assoc_multi <- calc_assoc_all(d = bike_s,
                                   measures = c("pearson",
                                                "dcor",
                                                "cancor"))
bike_s_assoc_multi
```



# corVis: Visualising Association

This section provides a detailed description of the novel visualisation techniques proposed in the package \CRANpkg{corVis}. These methods display measures of association and conditional association for variable pairs in a dataset and show multiple bivariate measures of association simultaneously. The package includes functions such as `plot_assoc_matrix` and `plot_assoc_linear` to produce these displays in a matrix and linear layout respectively. In addition, the package also provides a function `show_assoc` for a quick graphical overview of the relationship between two variables. It displays a scatterplot for numeric pairs, a bar plot for ordered and factor pairs, and a box plot for mixed variable pairs.


## Association Measures Plots

For association analysis, we start with calculating the default association measures for the bike sharing data (we drop variables dteday, weekday, atemp and cnt) using `calc_assoc` and then plot this result using `plot_assoc_matrix` in a matrix layout in Figure \@ref(fig:assoc-matrix-bike). 

```{r assoc-matrix-bike,fig.width=3, fig.height=3, fig.align='center', fig.cap="Association matrix display for bike sharing data showing Pearson's correlation for the numeric pairs, Goodman Kruskal's gamma measure for ordered pairs and canonical correlation for factor pairs and mixed pairs. The off diagonal cells show the measure value for a variable pair using a square glyph. The color of every square is mapped with the measure value for the pair and the area of the square is mapped to absolute measure value for the corresponding variable pair. The plot shows many pairs with strong association, for example (casual, temp), (registered,yr) and (weathersit,hum). Also, there is a negative association for (windspeed,registered) suggesting the number of registered users decreased during windy days.",echo=TRUE}

bike$dteday <- NULL 
bike$weekday <- NULL
bike$atemp <- NULL
bike$cnt <- NULL

bike_assoc <- calc_assoc(d = bike)
plot_assoc_matrix(lassoc = bike_assoc)
```

The diagonal cells in Figure \@ref(fig:assoc-matrix-bike) represent the variables present in the data. Every off diagonal cell contains a glyph, square in this plot, which is filled with a divergent color scale representing the value of corresponding association measure for a variable pair. The `glyph` argument can be either `square` or `circle`. The area of the square is mapped to absolute value of the association measure which quickly highlights the associated pairs of variables. We also offer ordering of the variables in this display so that highly-associated variables are arranged closer to each other and the task of detecting patterns becomes easier. The argument `var_order` is used for the variables in the matrix display. The function uses average linkage hierarchical clustering of the association matrix for ordering the variables, which clusters the highly associated variables together and arranges them nearby.

Figure \@ref(fig:assoc-matrix-bike) presents the novel feature of our display showing all the variables of a dataset in the same plot compared to corrgram which only shows association between numeric pairs. With canonical correlation as association measure for factor pairs or mixed pairs, we can observe from Figure \@ref(fig:assoc-matrix-bike) that pairs such as (weathersit, humidity), (workingday, registered), (yr,casual), (season, casual) and (season, registered) are strongly associated.

In some cases, an analyst might want to handle some factors as ordinals to see the direction of association. As discussed in the previous section, we can convert variable types by specifying the `coerce_types` argument. The code below shows an implementation and produces a display with some factor variables as ordinals.

```{r,coerce-types-display, fig.width=3, fig.height=3, fig.align='center', fig.cap="Association matrix display for bike sharing data showing Pearson's correlation for the numeric pairs, Goodman Kruskal's gamma measure for ordered pairs, canonical correlation for factor pairs and mixed pairs. The color of every circle is mapped with the measure value for the pair and the area of the circle is mapped by absolute measure value for the corresponding variable pair. The variables workingday, yr, weathersit and holiday have been converted to ordinals. The plot shows a strong negative association for (workingday, holiday) because no holiday is a working day.",echo=TRUE}
bike_assoc_o <- calc_assoc(bike, 
                           coerce_types=list(ordinal=c("workingday", 
                                                       "yr", 
                                                       "weathersit", 
                                                       "holiday")))

plot_assoc_matrix(bike_assoc_o,
                  glyph="circle")
```

Figure \@ref(fig:coerce-types-display) shows a strong negative association for (workingday, holiday) as holidays are not working days.


We use function `show_assoc` to to explore associated variable pairs graphically. Figure \@ref(fig:int-pairs-bike) display scatterplots for pairs (temp,registered) and (windspeed,hum) showing a strong positive and negative trend respectively. The boxplot for pair (workingday,casual) shows a high number of casual users using bikes on days that were not working day. The barplot for variable pair (workingday, holiday) confirms that no working day was a holiday.

```{r int-pairs-bike, fig.show="hold", out.width="50%", fig.cap = "Scatterplots for numeric pair (temp,registered) and (windspeed,hum),  boxplot for mixed pair (workingday,casual) and barplot for ordinal pair ((workingday, holiday) showing association between the pairs of variables.", echo=FALSE}
show_assoc(d = bike, 
           x = "temp", 
           y = "registered")

show_assoc(d = bike, 
           x = "windspeed", 
           y = "hum")

show_assoc(d = bike, 
           x = "workingday", 
           y = "casual")

show_assoc(d = bike, 
           x = "workingday", 
           y = "holiday")
```


## Multiple Association Measures Plot

The multiple measures plot compares association measures for variable pairs in a dataset. This display is useful in detecting pairs showing non-linear association which then can be explored further in more detail. The first step in producing the display is to calculate multiple pairwise association measures for a dataset using `calc_assoc_all` function. The output of the function is then fed into either `plot_assoc_matrix` or `plot_assoc_linear` to produce a display with matrix or linear layout. 

The `plot_assoc_matrix` function constructs a matrix display where the diagonal cells represent the variables and off-diagonal cells show variable pairs with multiple association measures as lollipop. The height and colour of the lollipops are mapped with the absolute value and by the type of association measure. An association measure tibble including every variable pair is the required input.

For ordering the display, the argument `var_order` is set to `max_diff` which creates a matrix with entries of maximum difference between the absolute value of measures for a variable pair. The variable ordering is then taken from the hierarchical clustering using average linkage method of this matrix. This orders the cells with large difference between the measures close to the diagonal and are easier to identify.

Figure \@ref(fig:compare-matrix) shows a multiple association measures plot in matrix layout for bike sharing dataset. We convert the factor variable `mnth` into numeric and use only numeric variables to produce the display. The plot compares the absolute values of association measures such as `ace`, `cancor`, `dcor`, `kendall`, `mic`, `nmi`, `pearson` and `spearman` for every variable pair in the dataset.   

```{r compare-matrix,fig.width=4, fig.height=4.5, fig.align='center',fig.cap="Multiple association measures plot in a matrix layout for numeric variables in bike sharing data. The lollipops in each cell represent the value of the association measure colored by the type of measure. The variable pairs are ordered by the maximum difference between the absolute value of association measures such that cells with highest difference are close to the diagonal. The plot shows that pairs (casual,mnth) and (mnth,temp) might have a non-linear association which can be explored further.",echo=TRUE}
biken <- bike |>
  mutate(mnth=as.numeric(mnth)) |>
  select(where(is.numeric))

biken_assoc_all <-calc_assoc_all(biken)
plot_assoc_matrix(biken_assoc_all) 
```

It is evident from the Figure \@ref(fig:compare-matrix) that pairs (casual,mnth) and (mnth,temp) have higher value for `ace` compared to other measures. The measures `nmi`, `dcor` and `mic` have similar values but higher than `pearson`, `spearman` and `kendall`. This suggests the presence of a non-linear pattern for these pairs. 

We use `show_assoc` to explore the pattern for these variable pairs in Figure \@ref(fig:int-pairs-multiple). It is evident from the scatterplots that both (casual,mnth) and (mnth,temp) show a non-linear relationship which measures such as Pearson, Kendall or Spearman correlation failed to capture. The `ace` measure detects this non-linear association efficiently as the `ace` algorithm estimates the transformations of variables which leads to maximal correlation for the variable pair and uncovers non-linear pattern.

```{r int-pairs-multiple, fig.show="hold", out.width="50%", fig.cap = "Scatterplot for variable pairs (from left to right) (casual,mnth) and (mnth,temp) showing a non-linear relationship for these pairs.",echo=FALSE}

show_assoc(biken, "mnth", "casual")
show_assoc(biken, "mnth", "temp")
```



<!-- The function `plot_assoc_linear` is used to display Figure \@ref(fig:compare-linear-heatmap). The function takes tibble of association measures calculated by `calc_assoc_all` as input and outputs a multiple association measures plot in linear layout. `group_var` argument is set to `measure_type` for a multiple measures plot. A maximum difference ordering is used for the plot by setting the `var_order` argument to `max_diff`. The `plot_type` argument is used for the type of plot for plotting the association measures. It is set to `heatmap` for rendering the color intensity to measure value or `dotplot` when points are used to represent the measure value. The `limits` argument is set to `c(0,1)` for multiple measures plot. -->


## Conditional Association Measures Plot

The conditional association plot explores bivariate association at different levels of a categorical variable. This display is useful for identifying pairs of variables showing different patterns at different levels of a conditioning variable. To produce this display, the first step is to calculate association measures for the variable pairs using `calc_assoc` function at each level of conditioning variable which is specified using the `by` argument. The calculated association measures are then used as inputs to `plot_assoc_matrix` or `plot_assoc_linear` to produce a display with matrix or linear layout. 

The `plot_assoc_matrix` function constructs a conditional association matrix display where the diagonal cells represent the variables and off-diagonal cells show variable pairs with association measures as lollipops for levels of a conditioning variable. The height and colour of the lollipops are mapped with the value of association measure and level of the conditioning variable respectively. The overall value of association measure for the corresponding pair of variable in a cell is represented by a pink horizontal line. The function takes an association measure tibble including every variable pair as the required input.

For ordering the display, the argument `var_order` is set to either `default` or `max_diff`. The default ordering is taken from the ordering of variables obtained by applying average linkage hierarchical clustering to the matrix of overall association measure. When `var_order` is set to `max_diff`, a matrix with entries of maximum difference of association measure at different levels of conditioning variable for a variable pair is created and clustered using hierarchical method to get the ordering of the variables.

Figure \@ref(fig:cond-assoc) shows a conditional association plot for the bike sharing data in matrix layout. Each cell corresponding to a variable pair shows four lollipops which correspond to the association measure (Pearson's correlation for numeric pairs, Goodman and Kruskal's gamma for ordinal pair, canonical correlation for nominal or mixed pairs) calculated at the levels of conditioning variable `season`. The horizontal pink line represents the overall association measure for the pair. The plot shows a low overall correlation between hum and temp. This is also true in Spring and Winter, but the association is positive in fall and negative in Summer. Also, the overall correlation between registered and temp is moderate and positive. This is also true in each season except for summer where
the correlation is about 0. The same pattern also holds for casual. 

```{r cond-assoc,fig.width=4.5, fig.height=4.5, fig.align='center', fig.cap="Conditional Association plot for bike sharing data showing Pearson's correlation for numeric pairs, Goodman and Kruskal's gamma for ordinal pair, canonical correlation for nominal or mixed pairs. The lollipops in each cell represent the value for asssociation measure colored by the conditioning variable season. The pink horizontal line in each cell represents overall value of the association measure. The plot shows evident difference in measure value for pairs (temp, hum), (temp, registered), (temp, casual) and (registered, casual) for different seasons.",echo=TRUE}

bike_by_assoc <- select(bike, -workingday, -holiday, -mnth, -yr) |>
  calc_assoc(by="season", 
                  coerce_types=list(ordinal=c( "weathersit")))


plot_assoc_matrix(bike_by_assoc)
```

We explore these variable pairs in more detail using `show_assoc`. Figure \@ref(fig:int-pairs-conditional) shows scatterplots for variable pairs (temp, hum), (temp, registered), (temp, casual) and (registered, casual) faceted by conditioning variable season. The faceted scatterplot for (temp, hum) show the decrease in humidity with increase in temperature in Summer and the oppsoite during Fall. Clearly, the plot for (temp, registered) and (temp, casual) show that there is no clear pattern for registered and casual with temperature in Summer compared to other seasons.

```{r  int-pairs-conditional, fig.show="hold", out.width="50%", fig.cap = "Scatterplots for variable pairs (temp, hum), (temp, registered), (temp, casual) and (registered, casual) faceted by conditioning variable season", echo=FALSE}

show_assoc(bike, "temp", "hum", by="season")

show_assoc(bike, "temp", "registered", by="season")

show_assoc(bike, "temp", "casual", by="season")

show_assoc(bike, "registered", "casual", by="season")
```


We also use linear layouts for displaying conditional association in the package. The function `plot_assoc_linear` is used for displaying a linear layout of the conditional association for variable pairs in the dataset. The association measures are calculated for every variable pair at each level of partitioning variable using `calc_assoc` function with conditioning variable as the `by` argument. The function takes an association measure tibble with every variable pair (not necessarily) as the required input. The measures are then displayed using a dotplot (or a heatmap) where color of the dots (or each cell) is coded by the level of the partitioning variable and the variable pairs are ordered by absolute maximum value of association measure for each of the pair of variable. These displays are also efficient for discovering differences among the levels of partitioning variable in the data. In comparison to matrix layout, it is easier to omit less relevant pairs of variables in linear layouts by filtering the variables pairs having a higher value for association measures than a threshold.


Figure \@ref(fig:linear-cond-assoc) shows a linear display for conditional association measures with  the variable pairs having absoulte measure value greater than $0.2$  along the Y-axis, the value of association measure along X-axis and color of the points representing the level of the grouping variable. The linear layout becomes more useful over the matrix layout for conditional association display when the number of variables and number of levels of grouping variable are high.

```{r linear-cond-assoc,fig.width=5, fig.height=4, fig.align='left', fig.cap="Conditional Association plot for bike sharing data using linear layout.The display has variable pairs on the Y-axis and the value of association measures on the X-axis. The points corresponding to every variable pair represents the value of association measure for different levels of the conditioning variable and the overall value of association measure.",echo=TRUE}

bike_by_assoc <- select(bike, -workingday, -holiday, -mnth, -yr) |>
  calc_assoc(by="season", 
                  coerce_types=list(ordinal=c( "weathersit")))
bike_by_assoc <- dplyr::filter(bike_by_assoc, abs(measure) > 0.2)
plot_assoc_linear(assoc = bike_by_assoc,
                  plot_type = "dotplot")
```



# Discussion


We use multiple association measures in a single display for different variable pairs which serves as a comparison tool while exploring association in a dataset and assist in identifying unusual variable pairs. These multiple measures can be displayed in a scatterplot matrix similar to what @tukey1985computer proposed. They suggested that scatterplot matrix of the scagnostics measures, which are measures summarizing a scatterplot, can be used to identify unusual scatterplots or variable pairs. @wilkinson2005graph used this idea with their graph-theoretic scagnostic measures to highlight unusual scatterplots. Similarly, @kuhn2013applied have used this idea in a predictive modeling context. They have produced a scatterplot matrix of the measures between the response and continuous predictors such as Pearson's correlation coefficient, pseudo-$R^2$ from the locally weighted regression model, MIC and Spearman's rank correlation coefficient to explore the predictor importance during feature selection step. These displays show the importance of comparing multiple association measures at once for different variable pairs. 
