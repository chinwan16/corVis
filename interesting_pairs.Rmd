---
title: "Finding interesting pairs of variables"
author: "Amit Chinwan"
output: html_document
editor_options: 
  chunk_output_type: console
---


```{r Loading libraries}
library(corVis)
library(dplyr)
library(tidyr)
library(palmerpenguins)
library(GGally)
library(HDoutliers)
```

## Bckground: Graph-Theoretic scagnostics

The idea of using measures to summarize a scatterplot proposed by Tukey and Tukey was an interesting idea. Using these measures, Tukeys aimed to detect anomalies in density, shape, trend, and other features in the 2D point scatters. Tukeys introduced the idea of scatterplot matrix of scagnostic measures and suggested that with brushing and linking tools, unusual scatterplots could be identified from **outliers in the scagnostic SPLOM**. Below is a plot showing comparison of multiple scagnostic measures for penguins data.

```{r}
df <- penguins
outlying <- tbl_scag(df,scagnostic = "Outlying")
skewed <- tbl_scag(df,scagnostic = "Skewed")
clumpy <- tbl_scag(df,scagnostic = "Clumpy")
sparse <- tbl_scag(df,scagnostic = "Sparse")
striated <- tbl_scag(df,scagnostic = "Striated")
convex <- tbl_scag(df,scagnostic = "Convex")
skinny <- tbl_scag(df,scagnostic = "Skinny")
stringy <- tbl_scag(df,scagnostic = "Stringy")
monotonic <- tbl_scag(df,scagnostic = "Monotonic")

scag_measures <- rbind(outlying, skewed, clumpy, sparse, striated, convex, skinny, stringy,
                       monotonic)
pairwise_1d_compare(scag_measures, limits = c(0,1))
```

Wilkinson et al followed the idea of scagnostics SPLOM and used brushing and linking tools to identify outliers and detect unusual scatterplot or variable pairs.

## Interesting pairs by identifying outliers

The idea of using brushing and linking tools for identifying outliers is tedious and is inefficient when the number of variables in a dataset is high. Instead, one can use algorithms to find outliers from a dataset of multiple association measures. The package *HDoutliers* uses Leland Wilkinsonâ€™s hdoutliers algorithm for outlier detection. Below is an example to idenitfy outliers with a dataset of scagnostic measures.

```{r}
scag_measures_wide <- pivot_wider(scag_measures,1:2,names_from = measure_type, 
                                  values_from = measure )

outliers <- HDoutliers(scag_measures_wide[,3:7])
outliers
```

For this case, there seems to be no outliers and hence no interesting scatterplots.


Below is an example where a dataset is created for numeric variable pairs in the `Boston` data along with association measures available in the package `corVis`. I applied hdoutliers algoirthm to this dataset in order to find any outlying scatterplots which are then further looked at in more detail. I used `OutliersO3` package, which uses hdoutliers algoirthm to find combinations of variables to find outlying cases in a dataset, to plot the cases which are outliers  
```{r}
library(zenplots)
#data("de_elect")
df <- MASS::Boston

pearson <- tbl_cor(df,method = "pearson")
spearman <- tbl_cor(df, method = "spearman")
kendall <- tbl_cor(df, method = "kendall")
distance <- tbl_dcor(df)
mic <- tbl_mine(df)
ace <- tbl_ace(df)

compare_assoc <- rbind(pearson, spearman, kendall, distance, mic, ace)
compare_assoc$measure <- abs(compare_assoc$measure)

compare_assoc$measure_type <- factor(compare_assoc$measure_type,levels =c("mic","dcor","pearson","spearman","kendall","ace"))
#pairwise_1d_compare(compare_assoc)
```

```{r,warning=FALSE,message=FALSE}
library(OutliersO3)
compare_assoc_wide <- pivot_wider(compare_assoc,1:2,names_from = measure_type, 
                                  values_from = measure )
outlier_prep <- O3prep(compare_assoc_wide[,3:8])
O3plot <- O3plotT(outlier_prep)
O3plot$gO3
#ggpairs(compare_assoc_steel_wide[,3:6])
compare_assoc_wide[1,]
compare_assoc_wide[33,]
compare_assoc_wide[77,]
```
The cases (or variable pairs) 1, 33 and 77 are outliers and have been plotted below to investigate further.


```{r}
ggplot(data=df) + geom_point(aes(x=zn,y=crim)) # case 1
ggplot(data=df) + geom_point(aes(x=ptratio,y=indus)) # case 33
ggplot(data=df) + geom_point(aes(x=tax,y=rad)) # case 77
```


### stray algorithm

Here, the stray algorithm has been used to identify outlying scatterplots. The stray algorithm outputs an outlying score suggesting the outlyingness of various cases of the dataset.
```{r}
library(stray)

outliers_stray <- find_HDoutliers(compare_assoc_wide[,3:8])
outliers_stray

wide_outliers <- (compare_assoc_wide[,3:8])
wide_outliers$out <- ifelse(outliers_stray$out_scores>0.2,"out","nout")

ggparcoord(wide_outliers,columns = 1:4,groupColumn = "out",scale = "globalminmax")

```

I ranked the variable pairs on the basis of the outlying score from the stray algorithm and filtered out the top 10 variable pairs which have the highest outlying score. These variable pairs are then plotted using `zenplot` function from zenplots package.
```{r,warning=FALSE,message=FALSE}
compare_assoc_wide$out_score <- outliers_stray$out_scores 

compare_assoc_wide_rank <- compare_assoc_wide %>%
  arrange(desc(out_score))
head(compare_assoc_wide_rank)

library(zenplots)
top10_var_pairs <- unique(c(unique(compare_assoc_wide_rank$x[1:10]),
                     unique(compare_assoc_wide_rank$y[1:10])))
df_new <- df[,top10_var_pairs]

path <- c(1,4,3,10,6,8,1,7,3,2,9,11,5)
turns <- c("d","r","d","r","d","r","d","r","d","l","l",
           "d","r","d","r","d","r","d","r","d","l")


zenplot(df_new,path=path,turns = turns)


```





