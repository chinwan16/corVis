---
title: "Introduction to corVis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{intro_corVis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(corVis)
library(mlr3data)
```


```{r setup2, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE,fig.align = "center",fig.height = 10,fig.width = 10)
```

corVis is an R package which calculates different correlation measures for a dataset and can help in visualising these correlations in different ways. These displays can help find interesting patterns in a dataset.

## Correlation

Correlation is a measure of association between two random variables. There are different methods which have been proposed to calculate the strength (or direction) of association. For example, pearson's correlation coefficient calculates the strength and direction of the linear association present between two variables and it is in the range $[-1,1]$. A correlation measure can be considered a good measure if it is symmetric. Correlation measures serve as important tools during the Exploratory Data Analysis (EDA) process. These measures can be used for screening variables which are highly correlated in a high-dimensional dataset prior to modeling.

In this package we provide a range of correlation measures which can capture linear and non-linear associations between two variables. The available correlation measures include - *pearson*, *spearman*, *kendall*, *distance*, *maximal information coefficient (mic)*. A user can use `association_measure` to calculate one of these correlation measure between all the possible variable pairs in the dataset. 

```{r}
df <- ilpd[,-c(2,11)]
dplyr::glimpse(association_measure(data = df,method = "pearson"))
```

A functionality to calculate correlation among the variable pairs in a grouped setting has also been introduced in  `association_measure`. One can use `group_by` to specify a grouping variable and the correlation measure will be calculated for all the variable pairs at each level of the grouping variable. 

```{r}
df <- ilpd[,-11]
distance <- association_measure(data = df,group_by = "gender",method = "distance")
```

## Correlation displays

The package also helps in plotting the calculated correlations in different displays. We have provided both matrix as well as linear layout for displaying these correlation measures. A user can pick either display to visualise correlations.

### Measures using bars
```{r}
bar_display(distance)
```

Different measures on upper and lower triangle
```{r}
pearson <- association_measure(data = df,group_by = "gender",method = "pearson")
bar_display(pearson,distance)
```

### Measures using heatmap
```{r}
all_measures <- association_measures(df[,-2])
heatmap_measures_Viz(all_measures)
```


### Heatmap with measures faceted by grouping variable
```{r}
all_measures <- association_measures(df,group_by = "gender")
heatmap_measures_Viz(all_measures,group_by="gender")
```


### Funnel plot with a designated response
For the regression setting where we have a continuous response, we can also plot the correlations among the response variable and the continuous independent variables grouped by a grouping variable. This plot can help us in finding out the highly correlated variables with the response.

```{r}
df <- ilpd[,-11]
pearson <- association_measure(data = df,group_by = "gender",method = "pearson")
funnel_plot(pearson,response = "alkaline_phosphatase")

```

```{r}
df <- ilpd[,-2]
pearson <- association_measure(data = df,group_by = "diseased",method = "pearson")
funnel_plot(pearson,response = "alkaline_phosphatase")
```


### Heatmap for categorical variables
```{r}
df <- thyroid_disease
df$patient_gender <- factor(df$patient_gender)
df$sick <- factor(df$sick)
df$psych_condition <- factor(df$psych_condition)
df$thyroid_surgery <- factor(df$thyroid_surgery)
df$ThryroidClass <- factor(df$ThryroidClass)

factor_vars <- names(which(sapply(df,is.factor)))
df_factors <- df[,factor_vars]

library(correlationfunnel)
library(corrplot)
binarized_df_factors <- binarize(df_factors)
corr_mat <- cor(binarized_df_factors)
corrplot(corr_mat)
```

